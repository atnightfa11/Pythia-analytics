import{c as S,j as e,U as N,S as w,T as k,E as D}from"./index-a6rvXRZ2.js";import{r as u,R as E}from"./react-vendor-ClEiMBPH.js";import"./chart-vendor-DtCDP6BD.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=S("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),C=E.lazy(()=>Promise.resolve({default:({data:c})=>{if(!c.length)return e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-slate-400",children:"No data to display"})});const d=Array.from(new Set(c.map(s=>s.cohort))).sort(),g=Math.max(...c.map(s=>s.dayOffset)),h=Array.from({length:Math.min(g+1,31)},(s,t)=>t),m=new Map;c.forEach(s=>{m.set(`${s.cohort}-${s.dayOffset}`,s)});const f=s=>{if(s===0)return"bg-slate-700";const t=Math.min(s/100,1);return t<.2?"bg-purple-900/20":t<.4?"bg-purple-800/40":t<.6?"bg-purple-700/60":t<.8?"bg-purple-600/80":"bg-purple-500"},l=Math.max(16,Math.min(24,600/Math.max(d.length,h.length)));return e.jsx("div",{className:"overflow-auto",children:e.jsxs("div",{className:"min-w-max",children:[e.jsxs("div",{className:"flex mb-1",children:[e.jsx("div",{className:"w-20 flex-shrink-0"}),h.map(s=>e.jsx("div",{className:"text-xs text-slate-400 text-center flex-shrink-0",style:{width:l,minWidth:l},children:s===0?"D0":s%7===0?`W${s/7}`:s},s))]}),d.slice(0,20).map(s=>e.jsxs("div",{className:"flex mb-1",children:[e.jsx("div",{className:"w-20 flex-shrink-0 text-xs text-slate-400 pr-2 flex items-center",children:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),h.map(t=>{const i=m.get(`${s}-${t}`),x=(i==null?void 0:i.retentionRate)||0,r=(i==null?void 0:i.sessions)||0;return e.jsx("div",{className:`flex-shrink-0 border border-slate-600 ${f(x)} hover:border-slate-400 transition-colors cursor-pointer`,style:{width:l,height:l,minWidth:l},title:`${s} Day ${t}: ${x}% retention (${r} sessions)`,children:r>0&&l>=20&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white font-medium",children:x>=10?Math.round(x):""})})},`${s}-${t}`)})]},s))]})})}}));function _({className:c=""}){const[d,g]=u.useState([]),[h,m]=u.useState(!0),[f,l]=u.useState(null);u.useEffect(()=>{(async()=>{var n;try{m(!0),l(null),console.log("📊 Fetching cohort analysis data...");const a=await fetch("/.netlify/functions/cohort-analysis?days=30");if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const p=await a.json();if(p.error)throw new Error(p.error);console.log("✅ Cohort data loaded:",((n=p.data)==null?void 0:n.length)||0,"data points"),g(p.data||[])}catch(a){console.error("❌ Failed to fetch cohort data:",a),l(a instanceof Error?a.message:"Failed to load cohort data")}finally{m(!1)}})()},[]);const t=(r=>{if(!r.length)return[];const n={};r.forEach(o=>{n[o.cohort_day]||(n[o.cohort_day]={}),n[o.cohort_day][o.day_offset]=o.sessions});const a=[];return Object.keys(n).sort().forEach(o=>{const y=n[o];for(let j=0;j<=30;j++){const b=y[j]||0,v=y[0]||1,$=v>0?b/v*100:0;a.push({cohort:o,dayOffset:j,sessions:b,retentionRate:Math.round($*10)/10,day0Sessions:v})}}),a})(d),i=new Set(d.map(r=>r.cohort_day)).size,x=d.reduce((r,n)=>r+n.sessions,0);return h?e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${c}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-purple-900/50 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"30-Day Retention Cohorts"})]}),e.jsx("div",{className:"flex items-center justify-center h-[400px]",children:e.jsx(w,{size:"lg"})})]}):f?e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${c}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-purple-900/50 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"30-Day Retention Cohorts"})]}),e.jsx("div",{className:"flex items-center justify-center h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-400 mb-2",children:"Failed to load cohort data"}),e.jsx("p",{className:"text-sm text-slate-500",children:f})]})})]}):e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${c}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-900/50 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"30-Day Retention Cohorts"}),e.jsx("p",{className:"text-sm text-slate-400",children:"User retention by signup date"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsxs("span",{children:[i," cohorts"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsxs("span",{children:[x.toLocaleString()," sessions"]})]})]})]}),e.jsx("div",{className:"relative",children:t.length>0?e.jsx(D,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-slate-400",children:"Heatmap visualization unavailable"})}),children:e.jsx(u.Suspense,{fallback:e.jsx(w,{size:"lg",className:"h-[400px]"}),children:e.jsx(C,{data:t})})}):e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-slate-700/50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-8 h-8 text-slate-500 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No cohort data available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Start tracking users to see retention patterns"})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-slate-600 rounded"}),e.jsx("span",{children:"0% retention"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-400 rounded"}),e.jsx("span",{children:"100% retention"})]})]}),e.jsx("p",{children:"Each cell shows retention rate for cohort day vs. days since signup"})]})]})}export{_ as default};
