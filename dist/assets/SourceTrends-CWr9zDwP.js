import{j as e,T as r,S as u,a as p}from"./index-C1j8Y-HA.js";import{r as i}from"./react-vendor-ClEiMBPH.js";import{R as g,B as N,X as b,Y as v,T as w,f as S}from"./chart-vendor-DtCDP6BD.js";function E({className:n=""}){const[l,f]=i.useState([]),[d,o]=i.useState(!0),[x,m]=i.useState(null);i.useEffect(()=>{(async()=>{var t;try{o(!0),m(null),console.log("ðŸ“Š Fetching source trends data...");const a=await fetch("/.netlify/functions/source-trends");if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const c=await a.json();if(c.error)throw new Error(c.error);console.log("âœ… Source trends data loaded:",((t=c.data)==null?void 0:t.length)||0,"sources"),f(c.data||[])}catch(a){console.error("âŒ Failed to fetch source trends:",a),m(a instanceof Error?a.message:"Failed to load source trends")}finally{o(!1)}})()},[]);const h=l.map(s=>({name:s.source==="direct"?"Direct":s.source,visitors:s.visitors,percentage:parseFloat(s.percentage)})),j=l.reduce((s,t)=>s+t.visitors,0);return d?e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${n}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-teal-900/50 rounded-lg",children:e.jsx(r,{className:"w-5 h-5 text-teal-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Top Traffic Sources"})]}),e.jsx("div",{className:"flex items-center justify-center h-[300px]",children:e.jsx(u,{size:"lg"})})]}):x?e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${n}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-teal-900/50 rounded-lg",children:e.jsx(r,{className:"w-5 h-5 text-teal-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Top Traffic Sources"})]}),e.jsx("div",{className:"flex items-center justify-center h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-400 mb-2",children:"Failed to load source data"}),e.jsx("p",{className:"text-sm text-slate-500",children:x})]})})]}):e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700 p-6 ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-teal-900/50 rounded-lg",children:e.jsx(r,{className:"w-5 h-5 text-teal-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Top Traffic Sources"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Last 7 days â€¢ ",j.toLocaleString()," total visitors"]})]})]}),e.jsx(p,{className:"w-4 h-4 text-slate-500"})]}),h.length>0?e.jsx("div",{className:"mb-6",children:e.jsx(g,{width:"100%",height:200,children:e.jsxs(N,{data:h,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(b,{dataKey:"name",stroke:"#9ca3af",fontSize:12,angle:-45,textAnchor:"end",height:60}),e.jsx(v,{stroke:"#9ca3af",fontSize:12}),e.jsx(w,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #475569",borderRadius:"8px",color:"#f1f5f9"},formatter:(s,t)=>[`${s.toLocaleString()} visitors`,"Visitors"]}),e.jsx(S,{dataKey:"visitors",fill:"#14b8a6",radius:[4,4,0,0]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[200px] bg-slate-700/50 rounded-lg mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(r,{className:"w-8 h-8 text-slate-500 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No source data available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"UTM parameters will appear here"})]})}),e.jsx("div",{className:"space-y-3",children:l.slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-600 rounded-lg flex items-center justify-center text-white text-sm font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-100",children:s.source==="direct"?"Direct Traffic":s.source}),e.jsxs("p",{className:"text-xs text-slate-400",children:[s.medium!=="none"&&`${s.medium}`,s.campaign!=="none"&&` â€¢ ${s.campaign}`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-slate-100",children:s.visitors.toLocaleString()}),e.jsxs("p",{className:"text-xs text-slate-400",children:[s.percentage,"%"]})]})]},`${s.source}-${s.medium}-${t}`))}),l.length===0&&!d&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(r,{className:"w-8 h-8 text-slate-500 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No traffic sources found"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add UTM parameters to track sources"})]})]})}export{E as default};
